# 06_MY투자_상세.md - MY 투자 페이지 개발 문서

## 목차
1. [페이지 개요](#1-페이지-개요)
2. [백엔드 구현](#2-백엔드-구현)
3. [프론트엔드 구현](#3-프론트엔드-구현)
4. [관심종목 관리](#4-관심종목-관리)
5. [포트폴리오 관리](#5-포트폴리오-관리)
6. [투자 성과 분석](#6-투자-성과-분석)
7. [데이터 시각화](#7-데이터-시각화)
8. [실시간 업데이트](#8-실시간-업데이트)
9. [사용자 경험 최적화](#9-사용자-경험-최적화)
10. [보안 및 데이터 관리](#10-보안-및-데이터-관리)

---

## 1. 페이지 개요

### 1.1 목적
사용자의 투자 활동을 종합적으로 관리하고 모니터링할 수 있는 개인화된 대시보드. 관심종목 추적, 포트폴리오 분석, 투자 성과 시각화 등의 기능을 제공합니다.

### 1.2 주요 기능
- **관심종목 관리**: 실시간 주가, 뉴스, 차트 표시
- **포트폴리오 추적**: 보유 종목별 수익률 분석
- **투자 성과 분석**: 기간별 수익률 차트
- **추천 이력**: AI 추천 포트폴리오 이력
- **알림 설정**: 가격 변동 알림

### 1.3 파일 구조
```
web/
├── app.py                     # API 엔드포인트
├── templates/
│   └── my-investment.html     # MY 투자 페이지
└── static/
    ├── css/
    │   └── my-investment.css  # 페이지 스타일
    └── js/
        └── my-investment.js   # 페이지 기능
```

---

## 2. 백엔드 구현

### 2.1 메인 라우트 (`app.py:1274-1277`)

```python
@app.route('/my-investment')
def my_investment():
    """마이투자 페이지를 렌더링합니다."""
    return render_template('my-investment.html')
```

### 2.2 관심종목 API (`app.py:6024-6151`)

```python
@app.route('/api/watchlist', methods=['GET', 'POST', 'DELETE'])
def api_watchlist():
    """관심종목 관리 API"""
    try:
        session_id = session.get('user_id')
        if not session_id:
            session_id = f"user_{str(uuid.uuid4())[:8]}"
            session['user_id'] = session_id
            
        if request.method == 'GET':
            # 관심종목 목록 조회
            conn = sqlite3.connect(DB_PATH)
            c = conn.cursor()
            c.execute('''CREATE TABLE IF NOT EXISTS watchlist (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                user_id TEXT,
                stock_code TEXT,
                stock_name TEXT,
                added_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
            )''')
            
            c.execute('SELECT stock_code, stock_name FROM watchlist WHERE user_id = ?', (session_id,))
            watchlist_stocks = [{"code": row[0], "name": row[1]} for row in c.fetchall()]
            conn.close()
            
            # 실제 주가 데이터와 뉴스 정보 추가
            detailed_watchlist = []
            
            # 한국 주식 데이터 로드
            korean_stocks = real_data_manager.load_korean_stocks()
            news_data = real_data_manager.load_news_data()
            
            for stock in watchlist_stocks:
                stock_info = {
                    "code": stock["code"],
                    "name": stock["name"],
                    "price": 0,
                    "change": 0,
                    "change_rate": 0,
                    "volume": 0,
                    "sector": "분류 없음",
                    "news_count": 0,
                    "latest_news": None
                }
                
                # 주가 정보 찾기
                if korean_stocks and 'prices' in korean_stocks:
                    for price_data in korean_stocks['prices']:
                        if str(price_data.get('ticker', '')).strip() == stock["code"]:
                            stock_info.update({
                                "price": price_data.get('Close', 0),
                                "change": price_data.get('Close', 0) - price_data.get('Open', 0),
                                "change_rate": ((price_data.get('Close', 0) - price_data.get('Open', 0)) / price_data.get('Open', 1)) * 100 if price_data.get('Open', 0) > 0 else 0,
                                "volume": price_data.get('Volume', 0)
                            })
                            break
                
                # 섹터 정보 찾기
                if korean_stocks and 'tickers' in korean_stocks:
                    for ticker in korean_stocks['tickers']:
                        if str(ticker.get('ticker', '')).strip() == stock["code"]:
                            stock_info["sector"] = ticker.get('sector', '분류 없음')
                            break
                
                # 관련 뉴스 수 계산
                if news_data:
                    related_news = [n for n in news_data if stock["name"] in n.get('title', '') or stock["name"] in n.get('content', '')]
                    stock_info["news_count"] = len(related_news)
                    if related_news:
                        stock_info["latest_news"] = {
                            "title": related_news[0].get('title', ''),
                            "date": related_news[0].get('date', '')
                        }
                
                detailed_watchlist.append(stock_info)
            
            return jsonify({"success": True, "watchlist": detailed_watchlist})
```

**주요 기능**:
- 관심종목 CRUD 작업
- 실시간 주가 데이터 통합
- 관련 뉴스 카운트
- 섹터 정보 포함

### 2.3 포트폴리오 이력 API (`app.py:5984-5997`)

```python
@app.route('/api/portfolio-history', methods=['GET'])
def api_portfolio_history():
    """사용자별 포트폴리오 추천/분석 이력 반환 (최신 5개)"""
    try:
        session_id = session.get('user_id')
        if not session_id:
            session_id = f"user_{str(uuid.uuid4())[:8]}"
            session['user_id'] = session_id
        recs = get_portfolio_recommendations(session_id, limit=5)
        print(f"/api/portfolio-history: {session_id} 이력 {len(recs)}건 반환")
        return jsonify({"success": True, "history": recs})
    except Exception as e:
        print(f"/api/portfolio-history 오류: {e}")
        return jsonify({"success": False, "history": []})
```

### 2.4 사용자 프로필 API (`app.py:5999-6023`)

```python
@app.route('/api/profile', methods=['GET'])
def api_profile():
    """사용자 프로필/설문 분석 결과 반환 (supabase 기반)"""
    # 1. 쿼리 파라미터 user_id 우선 사용, 없으면 세션에서 가져옴
    user_id = request.args.get('user_id')
    if not user_id:
        user_id = session.get('user_id')
    if not user_id:
        user_id = f"user_{str(uuid.uuid4())[:8]}"
        session['user_id'] = user_id
    try:
        supabase = get_supabase_client()
        # profile_json, summary 모두 조회
        res = supabase.table("user_profiles").select("profile_json,summary").eq("user_id", user_id).order("created_at", desc=True).limit(1).execute()
        print(f"/api/profile: user_id={user_id}, 쿼리 결과={res.data}")
        if res.data and len(res.data) > 0:
            profile_json = res.data[0].get("profile_json", {})
            summary = res.data[0].get("summary", "")
            
            # 투자 성향 타입 결정
            investor_type = profile_json.get('investor_type', '분석 중')
            
            return jsonify({
                "success": True,
                "profile": {
                    "user_id": user_id,
                    "investor_type": investor_type,
                    "scores": profile_json.get('scores', {}),
                    "summary": summary,
                    "detailed_analysis": profile_json.get('detailed_analysis', {})
                }
            })
```

---

## 3. 프론트엔드 구현

### 3.1 HTML 구조 (`my-investment.html`)

#### 3.1.1 Hero 섹션 (12-46줄)
```html
<!-- Hero Section -->
<div class="hero-section">
    <div class="hero-content">
        <div class="hero-text">
            <h1>나만의 투자 대시보드</h1>
            <p>관심 종목을 관리하고, 포트폴리오를 추적하며,<br>
               AI가 추천한 투자 전략을 확인해보세요.</p>
        </div>
        <div class="hero-image">
            <img src="/static/images/my-investment-hero.svg" alt="MY 투자">
        </div>
    </div>
</div>
```

#### 3.1.2 관심종목 섹션 (88-200줄)
```html
<!-- Watchlist Section -->
<div class="watchlist-section">
    <div class="section-header">
        <h2 class="section-title">내 관심종목</h2>
        <div class="carousel-nav">
            <button class="carousel-btn prev" onclick="moveWatchlist(-1)">
                <i class="bi bi-chevron-left"></i>
            </button>
            <button class="carousel-btn next" onclick="moveWatchlist(1)">
                <i class="bi bi-chevron-right"></i>
            </button>
        </div>
    </div>
    
    <div class="watchlist-grid" id="watchlistGrid">
        <!-- 관심종목 카드들 -->
        <div class="stock-card">
            <div class="stock-header">
                <span class="stock-category">전기전자</span>
            </div>
            <h3 class="stock-name">삼성전자</h3>
            <p class="stock-ticker">005930</p>
            <div class="stock-price">₩72,300</div>
            <div class="stock-change up">
                <i class="bi bi-caret-up-fill"></i>
                <span>1,200 (+1.69%)</span>
            </div>
            <div class="stock-footer">
                <i class="bi bi-newspaper"></i>
                <span>관련 뉴스 3건</span>
            </div>
        </div>
        
        <!-- 종목 추가 카드 -->
        <div class="add-stock-card" onclick="openStockModal()">
            <i class="bi bi-plus-circle" style="font-size: 48px; color: #666; margin-bottom: 16px;"></i>
            <p style="color: #666; font-weight: 500;">종목 추가하기</p>
        </div>
    </div>
</div>
```

#### 3.1.3 포트폴리오 성과 섹션
```html
<!-- Portfolio Performance Section -->
<div class="portfolio-section">
    <div class="section-header">
        <h2 class="section-title">포트폴리오 성과</h2>
        <div class="period-selector">
            <button class="period-btn active" data-period="1M">1개월</button>
            <button class="period-btn" data-period="3M">3개월</button>
            <button class="period-btn" data-period="6M">6개월</button>
            <button class="period-btn" data-period="1Y">1년</button>
        </div>
    </div>
    
    <div class="performance-card">
        <div class="performance-summary">
            <div class="summary-item">
                <span class="summary-label">총 수익률</span>
                <span class="summary-value positive">+12.45%</span>
            </div>
            <div class="summary-item">
                <span class="summary-label">총 평가금액</span>
                <span class="summary-value">₩5,234,500</span>
            </div>
            <div class="summary-item">
                <span class="summary-label">총 수익금</span>
                <span class="summary-value positive">+₩580,300</span>
            </div>
        </div>
        
        <div class="performance-chart">
            <canvas id="performanceChart"></canvas>
        </div>
    </div>
</div>
```

### 3.2 CSS 스타일링

#### 3.2.1 관심종목 카드 스타일 (100-180줄)
```css
.stock-card {
    background: white;
    border: 1px solid #E5E5E5;
    border-radius: 12px;
    padding: 24px;
    transition: all 0.2s;
    cursor: pointer;
}

.stock-card:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    transform: translateY(-2px);
}

.stock-price {
    font-size: 28px;
    font-weight: 700;
    color: #000;
    margin-bottom: 8px;
}

.stock-change {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 16px;
    font-weight: 500;
}

.stock-change.up {
    color: #E60000; /* 한국 주식시장 상승 색상 */
}

.stock-change.down {
    color: #0051C7; /* 한국 주식시장 하락 색상 */
}
```

#### 3.2.2 추가 카드 스타일 (182-200줄)
```css
.add-stock-card {
    background: #F8F9FA;
    border: 2px dashed #D5D5D5;
    border-radius: 12px;
    padding: 24px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 280px;
    cursor: pointer;
    transition: all 0.2s;
}

.add-stock-card:hover {
    border-color: #1454FE;
    background: #F0F5FF;
}
```

### 3.3 JavaScript 구현

#### 3.3.1 MyInvestmentManager 클래스
```javascript
class MyInvestmentManager {
    constructor() {
        this.watchlist = [];
        this.portfolio = [];
        this.performanceChart = null;
        this.currentPeriod = '1M';
        
        this.init();
    }
    
    async init() {
        // 초기 데이터 로드
        await this.loadUserProfile();
        await this.loadWatchlist();
        await this.loadPortfolioHistory();
        
        // 이벤트 리스너 설정
        this.setupEventListeners();
        
        // 차트 초기화
        this.initializeCharts();
        
        // 실시간 업데이트 시작
        this.startRealtimeUpdates();
    }
    
    async loadUserProfile() {
        try {
            const response = await fetch('/api/profile');
            const data = await response.json();
            
            if (data.success) {
                this.renderUserProfile(data.profile);
            }
        } catch (error) {
            console.error('프로필 로드 실패:', error);
        }
    }
    
    async loadWatchlist() {
        try {
            const response = await fetch('/api/watchlist');
            const data = await response.json();
            
            if (data.success) {
                this.watchlist = data.watchlist;
                this.renderWatchlist();
            }
        } catch (error) {
            console.error('관심종목 로드 실패:', error);
        }
    }
    
    renderWatchlist() {
        const grid = document.getElementById('watchlistGrid');
        
        // 기존 카드 제거 (추가 버튼 제외)
        const addCard = grid.querySelector('.add-stock-card');
        grid.innerHTML = '';
        
        // 관심종목 카드 렌더링
        this.watchlist.forEach(stock => {
            const card = this.createStockCard(stock);
            grid.appendChild(card);
        });
        
        // 추가 버튼 다시 추가
        if (addCard) {
            grid.appendChild(addCard);
        } else {
            grid.appendChild(this.createAddCard());
        }
    }
    
    createStockCard(stock) {
        const card = document.createElement('div');
        card.className = 'stock-card';
        card.dataset.code = stock.code;
        
        const changeClass = stock.change >= 0 ? 'up' : 'down';
        const changeIcon = stock.change >= 0 ? 'bi-caret-up-fill' : 'bi-caret-down-fill';
        const changeSign = stock.change >= 0 ? '+' : '';
        
        card.innerHTML = `
            <div class="stock-header">
                <span class="stock-category">${stock.sector}</span>
                <button class="remove-btn" onclick="removeFromWatchlist('${stock.code}')">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
            <h3 class="stock-name">${stock.name}</h3>
            <p class="stock-ticker">${stock.code}</p>
            <div class="stock-price">₩${this.formatNumber(stock.price)}</div>
            <div class="stock-change ${changeClass}">
                <i class="bi ${changeIcon}"></i>
                <span>${changeSign}${this.formatNumber(stock.change)} (${changeSign}${stock.change_rate.toFixed(2)}%)</span>
            </div>
            <div class="stock-footer">
                <i class="bi bi-newspaper"></i>
                <span>관련 뉴스 ${stock.news_count}건</span>
            </div>
        `;
        
        // 클릭 이벤트
        card.addEventListener('click', (e) => {
            if (!e.target.closest('.remove-btn')) {
                this.showStockDetail(stock.code);
            }
        });
        
        return card;
    }
    
    createAddCard() {
        const card = document.createElement('div');
        card.className = 'add-stock-card';
        card.onclick = () => this.openStockModal();
        
        card.innerHTML = `
            <i class="bi bi-plus-circle" style="font-size: 48px; color: #666; margin-bottom: 16px;"></i>
            <p style="color: #666; font-weight: 500;">종목 추가하기</p>
        `;
        
        return card;
    }
    
    async addToWatchlist(code) {
        try {
            const response = await fetch('/api/watchlist', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ code })
            });
            
            const data = await response.json();
            
            if (data.success) {
                await this.loadWatchlist();
                this.showSuccess('관심종목에 추가되었습니다.');
            }
        } catch (error) {
            console.error('관심종목 추가 실패:', error);
            this.showError('관심종목 추가에 실패했습니다.');
        }
    }
    
    async removeFromWatchlist(code) {
        if (!confirm('관심종목에서 제거하시겠습니까?')) {
            return;
        }
        
        try {
            const response = await fetch('/api/watchlist', {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ code })
            });
            
            const data = await response.json();
            
            if (data.success) {
                await this.loadWatchlist();
                this.showSuccess('관심종목에서 제거되었습니다.');
            }
        } catch (error) {
            console.error('관심종목 제거 실패:', error);
            this.showError('관심종목 제거에 실패했습니다.');
        }
    }
    
    formatNumber(num) {
        return new Intl.NumberFormat('ko-KR').format(num);
    }
    
    showStockDetail(code) {
        // 종목 상세 페이지로 이동 또는 모달 표시
        window.location.href = `/stock/${code}`;
    }
    
    openStockModal() {
        // 종목 검색 모달 열기
        const modal = new StockSearchModal();
        modal.show();
    }
}
```

---

## 4. 관심종목 관리

### 4.1 종목 검색 모달

```javascript
class StockSearchModal {
    constructor() {
        this.stocks = [];
        this.createModal();
    }
    
    createModal() {
        const modal = document.createElement('div');
        modal.className = 'modal fade';
        modal.id = 'stockSearchModal';
        
        modal.innerHTML = `
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">종목 검색</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="search-box mb-3">
                            <input type="text" class="form-control" id="stockSearchInput" 
                                   placeholder="종목명 또는 종목코드를 입력하세요">
                        </div>
                        <div class="search-results" id="searchResults">
                            <!-- 검색 결과 표시 -->
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        document.body.appendChild(modal);
        this.modal = new bootstrap.Modal(modal);
        
        // 검색 이벤트
        const searchInput = document.getElementById('stockSearchInput');
        searchInput.addEventListener('input', (e) => this.handleSearch(e.target.value));
    }
    
    async handleSearch(query) {
        if (query.length < 2) {
            this.clearResults();
            return;
        }
        
        try {
            const response = await fetch(`/api/stocks/search?q=${encodeURIComponent(query)}`);
            const data = await response.json();
            
            if (data.success) {
                this.displayResults(data.results);
            }
        } catch (error) {
            console.error('검색 실패:', error);
        }
    }
    
    displayResults(results) {
        const container = document.getElementById('searchResults');
        
        if (results.length === 0) {
            container.innerHTML = '<p class="text-center text-muted">검색 결과가 없습니다.</p>';
            return;
        }
        
        container.innerHTML = results.map(stock => `
            <div class="search-result-item" onclick="selectStock('${stock.code}')">
                <div class="d-flex justify-content-between align-items-center p-3 border-bottom">
                    <div>
                        <h6 class="mb-1">${stock.name}</h6>
                        <small class="text-muted">${stock.code} | ${stock.sector}</small>
                    </div>
                    <div class="text-end">
                        <div class="fw-bold">₩${this.formatNumber(stock.price)}</div>
                        <small class="${stock.change >= 0 ? 'text-danger' : 'text-primary'}">
                            ${stock.change >= 0 ? '+' : ''}${stock.change_rate.toFixed(2)}%
                        </small>
                    </div>
                </div>
            </div>
        `).join('');
    }
    
    show() {
        this.modal.show();
    }
    
    hide() {
        this.modal.hide();
    }
}

// 전역 함수
window.selectStock = async function(code) {
    await window.myInvestmentManager.addToWatchlist(code);
    bootstrap.Modal.getInstance(document.getElementById('stockSearchModal')).hide();
};
```

### 4.2 관심종목 뉴스 API (`app.py:6268-6321`)

```python
@app.route('/api/watchlist-news')
def api_watchlist_news():
    """관심종목 관련 뉴스 API"""
    try:
        session_id = session.get('user_id')
        if not session_id:
            session_id = f"user_{str(uuid.uuid4())[:8]}"
            session['user_id'] = session_id
        
        # 관심종목 목록 가져오기
        conn = sqlite3.connect(DB_PATH)
        c = conn.cursor()
        c.execute('SELECT stock_code, stock_name FROM watchlist WHERE user_id = ?', (session_id,))
        watchlist = [{"code": row[0], "name": row[1]} for row in c.fetchall()]
        conn.close()
        
        # 뉴스 데이터 로드
        news_data = real_data_manager.load_news_data()
        watchlist_news = []
        
        if news_data and watchlist:
            # 각 관심종목에 대한 뉴스 검색
            for stock in watchlist:
                stock_news = []
                for news in news_data:
                    if stock["name"] in news.get('title', '') or stock["name"] in news.get('content', ''):
                        stock_news.append({
                            "stock_name": stock["name"],
                            "title": news.get('title', ''),
                            "content": news.get('content', '')[:200] + "...",
                            "date": news.get('date', datetime.now().strftime('%Y년 %m월 %d일')),
                            "link": news.get('link', '#'),
                            "sentiment": news.get('sentiment', 'neutral')
                        })
                
                if stock_news:
                    watchlist_news.extend(stock_news[:3])  # 종목당 최대 3개
        
        return jsonify({
            "success": True,
            "news": watchlist_news[:10]  # 전체 최대 10개
        })
```

---

## 5. 포트폴리오 관리

### 5.1 포트폴리오 데이터 구조

```python
# 포트폴리오 테이블 스키마
CREATE TABLE portfolio (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id TEXT NOT NULL,
    stock_code TEXT NOT NULL,
    stock_name TEXT NOT NULL,
    quantity INTEGER NOT NULL,
    avg_price REAL NOT NULL,
    current_price REAL,
    total_value REAL,
    profit_loss REAL,
    profit_loss_rate REAL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 5.2 포트폴리오 성과 계산

```python
class PortfolioAnalyzer:
    """포트폴리오 분석기"""
    
    def calculate_portfolio_performance(self, portfolio_items, period='1M'):
        """포트폴리오 성과 계산"""
        total_investment = 0
        total_current_value = 0
        
        for item in portfolio_items:
            # 투자금액
            investment = item['quantity'] * item['avg_price']
            total_investment += investment
            
            # 현재 가치
            current_value = item['quantity'] * item['current_price']
            total_current_value += current_value
            
            # 개별 종목 수익
            item['profit_loss'] = current_value - investment
            item['profit_loss_rate'] = (item['profit_loss'] / investment) * 100
        
        # 전체 포트폴리오 수익
        total_profit = total_current_value - total_investment
        total_return_rate = (total_profit / total_investment) * 100 if total_investment > 0 else 0
        
        return {
            'total_investment': total_investment,
            'total_current_value': total_current_value,
            'total_profit': total_profit,
            'total_return_rate': total_return_rate,
            'items': portfolio_items,
            'period_data': self.get_period_performance(portfolio_items, period)
        }
    
    def get_period_performance(self, portfolio_items, period):
        """기간별 성과 데이터"""
        # 기간에 따른 날짜 계산
        end_date = datetime.now()
        
        period_days = {
            '1M': 30,
            '3M': 90,
            '6M': 180,
            '1Y': 365
        }
        
        start_date = end_date - timedelta(days=period_days.get(period, 30))
        
        # 일별 포트폴리오 가치 계산
        daily_values = []
        current_date = start_date
        
        while current_date <= end_date:
            daily_value = self.calculate_daily_value(portfolio_items, current_date)
            daily_values.append({
                'date': current_date.strftime('%Y-%m-%d'),
                'value': daily_value
            })
            current_date += timedelta(days=1)
        
        return daily_values
```

### 5.3 포트폴리오 차트 렌더링

```javascript
class PortfolioChart {
    constructor(canvasId) {
        this.canvas = document.getElementById(canvasId);
        this.chart = null;
    }
    
    renderPerformanceChart(periodData) {
        const ctx = this.canvas.getContext('2d');
        
        if (this.chart) {
            this.chart.destroy();
        }
        
        // 데이터 준비
        const labels = periodData.map(d => d.date);
        const values = periodData.map(d => d.value);
        
        // 수익률 계산
        const initialValue = values[0];
        const returns = values.map(v => ((v - initialValue) / initialValue) * 100);
        
        this.chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: '포트폴리오 수익률 (%)',
                    data: returns,
                    borderColor: '#1454FE',
                    backgroundColor: 'rgba(20, 84, 254, 0.1)',
                    borderWidth: 2,
                    pointRadius: 0,
                    pointHoverRadius: 4,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                        callbacks: {
                            label: function(context) {
                                return `수익률: ${context.parsed.y.toFixed(2)}%`;
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        display: false
                    },
                    y: {
                        display: true,
                        grid: {
                            borderDash: [5, 5]
                        },
                        ticks: {
                            callback: function(value) {
                                return value.toFixed(1) + '%';
                            }
                        }
                    }
                },
                interaction: {
                    mode: 'nearest',
                    axis: 'x',
                    intersect: false
                }
            }
        });
    }
    
    renderAllocationChart(portfolio) {
        const ctx = document.getElementById('allocationChart').getContext('2d');
        
        // 섹터별 비중 계산
        const sectorAllocation = {};
        portfolio.forEach(item => {
            const sector = item.sector || '기타';
            const value = item.quantity * item.current_price;
            
            if (!sectorAllocation[sector]) {
                sectorAllocation[sector] = 0;
            }
            sectorAllocation[sector] += value;
        });
        
        const labels = Object.keys(sectorAllocation);
        const data = Object.values(sectorAllocation);
        
        new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: labels,
                datasets: [{
                    data: data,
                    backgroundColor: [
                        '#1454FE',
                        '#00C896',
                        '#FFB800',
                        '#FF6B6B',
                        '#4ECDC4',
                        '#95E1D3'
                    ],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'right',
                        labels: {
                            padding: 20,
                            usePointStyle: true,
                            font: {
                                size: 12
                            }
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                const percentage = ((context.parsed / total) * 100).toFixed(1);
                                return `${context.label}: ${percentage}%`;
                            }
                        }
                    }
                }
            }
        });
    }
}
```

---

## 6. 투자 성과 분석

### 6.1 성과 지표 계산

```javascript
class PerformanceMetrics {
    constructor(portfolio) {
        this.portfolio = portfolio;
    }
    
    calculateMetrics() {
        const metrics = {
            totalReturn: 0,
            annualizedReturn: 0,
            volatility: 0,
            sharpeRatio: 0,
            maxDrawdown: 0,
            winRate: 0,
            avgGain: 0,
            avgLoss: 0
        };
        
        // 총 수익률
        const totalInvestment = this.portfolio.reduce((sum, item) => 
            sum + (item.quantity * item.avg_price), 0);
        const totalValue = this.portfolio.reduce((sum, item) => 
            sum + (item.quantity * item.current_price), 0);
        
        metrics.totalReturn = ((totalValue - totalInvestment) / totalInvestment) * 100;
        
        // 승률 계산
        const winners = this.portfolio.filter(item => item.profit_loss > 0);
        const losers = this.portfolio.filter(item => item.profit_loss < 0);
        
        metrics.winRate = (winners.length / this.portfolio.length) * 100;
        
        // 평균 수익/손실
        if (winners.length > 0) {
            metrics.avgGain = winners.reduce((sum, item) => 
                sum + item.profit_loss_rate, 0) / winners.length;
        }
        
        if (losers.length > 0) {
            metrics.avgLoss = Math.abs(losers.reduce((sum, item) => 
                sum + item.profit_loss_rate, 0) / losers.length);
        }
        
        return metrics;
    }
    
    calculateRiskMetrics(priceHistory) {
        // 일별 수익률 계산
        const returns = [];
        for (let i = 1; i < priceHistory.length; i++) {
            const dailyReturn = (priceHistory[i] - priceHistory[i-1]) / priceHistory[i-1];
            returns.push(dailyReturn);
        }
        
        // 변동성 (표준편차)
        const avgReturn = returns.reduce((a, b) => a + b, 0) / returns.length;
        const variance = returns.reduce((sum, r) => 
            sum + Math.pow(r - avgReturn, 2), 0) / returns.length;
        const volatility = Math.sqrt(variance) * Math.sqrt(252); // 연율화
        
        // 최대 낙폭
        let maxDrawdown = 0;
        let peak = priceHistory[0];
        
        for (let i = 1; i < priceHistory.length; i++) {
            if (priceHistory[i] > peak) {
                peak = priceHistory[i];
            }
            const drawdown = (peak - priceHistory[i]) / peak;
            maxDrawdown = Math.max(maxDrawdown, drawdown);
        }
        
        // 샤프 비율 (무위험 수익률 2% 가정)
        const riskFreeRate = 0.02;
        const excessReturn = (avgReturn * 252) - riskFreeRate;
        const sharpeRatio = excessReturn / volatility;
        
        return {
            volatility: volatility * 100,
            maxDrawdown: maxDrawdown * 100,
            sharpeRatio: sharpeRatio
        };
    }
}
```

### 6.2 성과 대시보드

```html
<!-- Performance Dashboard -->
<div class="performance-dashboard">
    <div class="metric-grid">
        <div class="metric-card">
            <div class="metric-label">총 수익률</div>
            <div class="metric-value positive" id="totalReturn">+12.45%</div>
            <div class="metric-change">지난달 대비 +2.3%</div>
        </div>
        
        <div class="metric-card">
            <div class="metric-label">연율화 수익률</div>
            <div class="metric-value" id="annualizedReturn">18.2%</div>
            <div class="metric-change">KOSPI 대비 +5.1%</div>
        </div>
        
        <div class="metric-card">
            <div class="metric-label">변동성</div>
            <div class="metric-value" id="volatility">15.3%</div>
            <div class="metric-change">낮음</div>
        </div>
        
        <div class="metric-card">
            <div class="metric-label">샤프 비율</div>
            <div class="metric-value" id="sharpeRatio">1.24</div>
            <div class="metric-change">우수</div>
        </div>
    </div>
    
    <div class="win-loss-analysis">
        <h4>승률 분석</h4>
        <div class="win-loss-bar">
            <div class="win-bar" style="width: 65%">
                <span>승 65%</span>
            </div>
            <div class="loss-bar" style="width: 35%">
                <span>패 35%</span>
            </div>
        </div>
        <div class="win-loss-stats">
            <div class="stat">
                <span class="label">평균 수익</span>
                <span class="value positive">+8.3%</span>
            </div>
            <div class="stat">
                <span class="label">평균 손실</span>
                <span class="value negative">-4.2%</span>
            </div>
            <div class="stat">
                <span class="label">손익비</span>
                <span class="value">1.98</span>
            </div>
        </div>
    </div>
</div>
```

---

## 7. 데이터 시각화

### 7.1 히트맵 차트

```javascript
class HeatmapChart {
    constructor(containerId) {
        this.container = document.getElementById(containerId);
    }
    
    renderMonthlyReturns(data) {
        // 월별 수익률 히트맵
        const months = ['1월', '2월', '3월', '4월', '5월', '6월', 
                       '7월', '8월', '9월', '10월', '11월', '12월'];
        const years = [...new Set(data.map(d => d.year))].sort();
        
        const heatmapData = [];
        years.forEach((year, yIndex) => {
            months.forEach((month, mIndex) => {
                const monthData = data.find(d => 
                    d.year === year && d.month === mIndex + 1);
                
                if (monthData) {
                    heatmapData.push({
                        x: mIndex,
                        y: yIndex,
                        value: monthData.return,
                        year: year,
                        month: month
                    });
                }
            });
        });
        
        // D3.js를 사용한 히트맵 렌더링
        const margin = {top: 30, right: 30, bottom: 50, left: 60};
        const width = this.container.clientWidth - margin.left - margin.right;
        const height = 400 - margin.top - margin.bottom;
        
        const svg = d3.select(this.container)
            .append('svg')
            .attr('width', width + margin.left + margin.right)
            .attr('height', height + margin.top + margin.bottom)
            .append('g')
            .attr('transform', `translate(${margin.left},${margin.top})`);
        
        // 색상 스케일
        const colorScale = d3.scaleSequential()
            .interpolator(d3.interpolateRdYlGn)
            .domain([-10, 10]);
        
        // 히트맵 셀 렌더링
        svg.selectAll('rect')
            .data(heatmapData)
            .enter()
            .append('rect')
            .attr('x', d => d.x * (width / 12))
            .attr('y', d => d.y * (height / years.length))
            .attr('width', width / 12 - 2)
            .attr('height', height / years.length - 2)
            .attr('fill', d => colorScale(d.value))
            .attr('rx', 4)
            .on('mouseover', function(event, d) {
                // 툴팁 표시
                const tooltip = d3.select('body')
                    .append('div')
                    .attr('class', 'heatmap-tooltip')
                    .style('opacity', 0);
                
                tooltip.transition()
                    .duration(200)
                    .style('opacity', .9);
                    
                tooltip.html(`${d.year}년 ${d.month}<br/>수익률: ${d.value.toFixed(2)}%`)
                    .style('left', (event.pageX + 10) + 'px')
                    .style('top', (event.pageY - 28) + 'px');
            })
            .on('mouseout', function() {
                d3.selectAll('.heatmap-tooltip').remove();
            });
    }
}
```

### 7.2 트리맵 차트 (포트폴리오 구성)

```javascript
class TreemapChart {
    constructor(containerId) {
        this.container = document.getElementById(containerId);
    }
    
    renderPortfolioTreemap(portfolio) {
        const data = {
            name: "포트폴리오",
            children: portfolio.map(item => ({
                name: item.name,
                value: item.quantity * item.current_price,
                change: item.profit_loss_rate,
                sector: item.sector
            }))
        };
        
        const width = this.container.clientWidth;
        const height = 400;
        
        const treemap = d3.treemap()
            .size([width, height])
            .padding(2);
        
        const root = d3.hierarchy(data)
            .sum(d => d.value);
        
        treemap(root);
        
        const svg = d3.select(this.container)
            .append('svg')
            .attr('width', width)
            .attr('height', height);
        
        const cell = svg.selectAll('g')
            .data(root.leaves())
            .enter()
            .append('g')
            .attr('transform', d => `translate(${d.x0},${d.y0})`);
        
        // 색상 스케일 (수익률 기준)
        const colorScale = d3.scaleLinear()
            .domain([-10, 0, 10])
            .range(['#0051C7', '#FFFFFF', '#E60000']);
        
        cell.append('rect')
            .attr('width', d => d.x1 - d.x0)
            .attr('height', d => d.y1 - d.y0)
            .attr('fill', d => colorScale(d.data.change))
            .attr('stroke', '#fff')
            .attr('stroke-width', 2);
        
        // 종목명 표시
        cell.append('text')
            .attr('x', 4)
            .attr('y', 20)
            .text(d => d.data.name)
            .attr('font-size', '14px')
            .attr('fill', d => d.data.change > 5 || d.data.change < -5 ? '#fff' : '#000');
        
        // 수익률 표시
        cell.append('text')
            .attr('x', 4)
            .attr('y', 40)
            .text(d => `${d.data.change > 0 ? '+' : ''}${d.data.change.toFixed(1)}%`)
            .attr('font-size', '12px')
            .attr('fill', d => d.data.change > 5 || d.data.change < -5 ? '#fff' : '#666');
    }
}
```

---

## 8. 실시간 업데이트

### 8.1 WebSocket 연결

```javascript
class RealtimeDataManager {
    constructor() {
        this.ws = null;
        this.reconnectInterval = 5000;
        this.reconnectAttempts = 0;
        this.maxReconnectAttempts = 5;
        
        this.connect();
    }
    
    connect() {
        try {
            this.ws = new WebSocket('wss://api.pixie.com/realtime');
            
            this.ws.onopen = () => {
                console.log('실시간 연결 성공');
                this.reconnectAttempts = 0;
                this.subscribe();
            };
            
            this.ws.onmessage = (event) => {
                this.handleMessage(JSON.parse(event.data));
            };
            
            this.ws.onerror = (error) => {
                console.error('WebSocket 오류:', error);
            };
            
            this.ws.onclose = () => {
                this.handleDisconnect();
            };
            
        } catch (error) {
            console.error('WebSocket 연결 실패:', error);
        }
    }
    
    subscribe() {
        // 관심종목 구독
        const watchlist = window.myInvestmentManager.watchlist;
        const codes = watchlist.map(stock => stock.code);
        
        this.ws.send(JSON.stringify({
            type: 'subscribe',
            stocks: codes
        }));
    }
    
    handleMessage(data) {
        switch (data.type) {
            case 'price_update':
                this.handlePriceUpdate(data);
                break;
            case 'news_alert':
                this.handleNewsAlert(data);
                break;
            case 'market_status':
                this.handleMarketStatus(data);
                break;
        }
    }
    
    handlePriceUpdate(data) {
        const { code, price, change, change_rate, volume } = data;
        
        // UI 업데이트
        const card = document.querySelector(`[data-code="${code}"]`);
        if (card) {
            this.animatePriceUpdate(card, price, change, change_rate);
        }
        
        // 데이터 업데이트
        const stock = window.myInvestmentManager.watchlist.find(s => s.code === code);
        if (stock) {
            stock.price = price;
            stock.change = change;
            stock.change_rate = change_rate;
            stock.volume = volume;
        }
    }
    
    animatePriceUpdate(card, price, change, changeRate) {
        const priceEl = card.querySelector('.stock-price');
        const changeEl = card.querySelector('.stock-change');
        
        // 가격 변동 애니메이션
        priceEl.classList.add('price-update');
        setTimeout(() => priceEl.classList.remove('price-update'), 500);
        
        // 가격 업데이트
        priceEl.textContent = `₩${this.formatNumber(price)}`;
        
        // 변동 정보 업데이트
        const changeClass = change >= 0 ? 'up' : 'down';
        const changeIcon = change >= 0 ? 'bi-caret-up-fill' : 'bi-caret-down-fill';
        const changeSign = change >= 0 ? '+' : '';
        
        changeEl.className = `stock-change ${changeClass}`;
        changeEl.innerHTML = `
            <i class="bi ${changeIcon}"></i>
            <span>${changeSign}${this.formatNumber(change)} (${changeSign}${changeRate.toFixed(2)}%)</span>
        `;
    }
    
    handleDisconnect() {
        if (this.reconnectAttempts < this.maxReconnectAttempts) {
            this.reconnectAttempts++;
            console.log(`재연결 시도 ${this.reconnectAttempts}/${this.maxReconnectAttempts}`);
            
            setTimeout(() => {
                this.connect();
            }, this.reconnectInterval);
        } else {
            console.error('실시간 연결 실패');
            this.showConnectionError();
        }
    }
    
    showConnectionError() {
        const alert = document.createElement('div');
        alert.className = 'alert alert-warning alert-dismissible fade show';
        alert.innerHTML = `
            <i class="bi bi-exclamation-triangle"></i>
            실시간 데이터 연결이 끊어졌습니다. 
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;
        document.querySelector('.my-investment-container').prepend(alert);
    }
    
    formatNumber(num) {
        return new Intl.NumberFormat('ko-KR').format(num);
    }
}
```

### 8.2 폴링 방식 대안

```javascript
class PollingDataManager {
    constructor() {
        this.interval = 10000; // 10초
        this.timer = null;
        
        this.startPolling();
    }
    
    startPolling() {
        this.timer = setInterval(() => {
            this.fetchUpdates();
        }, this.interval);
        
        // 초기 로드
        this.fetchUpdates();
    }
    
    stopPolling() {
        if (this.timer) {
            clearInterval(this.timer);
            this.timer = null;
        }
    }
    
    async fetchUpdates() {
        try {
            const watchlist = window.myInvestmentManager.watchlist;
            const codes = watchlist.map(s => s.code).join(',');
            
            const response = await fetch(`/api/stocks/prices?codes=${codes}`);
            const data = await response.json();
            
            if (data.success) {
                this.updatePrices(data.prices);
            }
        } catch (error) {
            console.error('가격 업데이트 실패:', error);
        }
    }
    
    updatePrices(prices) {
        prices.forEach(priceData => {
            const stock = window.myInvestmentManager.watchlist.find(
                s => s.code === priceData.code
            );
            
            if (stock) {
                // 변경 사항 확인
                const hasChanged = stock.price !== priceData.price;
                
                // 데이터 업데이트
                Object.assign(stock, priceData);
                
                // UI 업데이트
                if (hasChanged) {
                    const card = document.querySelector(`[data-code="${stock.code}"]`);
                    if (card) {
                        window.realtimeManager.animatePriceUpdate(
                            card, 
                            priceData.price, 
                            priceData.change, 
                            priceData.change_rate
                        );
                    }
                }
            }
        });
    }
}

// 페이지 비활성화 시 폴링 중지
document.addEventListener('visibilitychange', () => {
    if (document.hidden) {
        window.pollingManager?.stopPolling();
    } else {
        window.pollingManager?.startPolling();
    }
});
```

---

## 9. 사용자 경험 최적화

### 9.1 드래그 앤 드롭 정렬

```javascript
class DragDropManager {
    constructor() {
        this.draggedElement = null;
        this.init();
    }
    
    init() {
        const watchlistGrid = document.getElementById('watchlistGrid');
        
        // 드래그 가능하게 설정
        watchlistGrid.addEventListener('dragstart', (e) => this.handleDragStart(e));
        watchlistGrid.addEventListener('dragover', (e) => this.handleDragOver(e));
        watchlistGrid.addEventListener('drop', (e) => this.handleDrop(e));
        watchlistGrid.addEventListener('dragend', (e) => this.handleDragEnd(e));
    }
    
    handleDragStart(e) {
        if (e.target.classList.contains('stock-card')) {
            this.draggedElement = e.target;
            e.target.style.opacity = '0.5';
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', e.target.innerHTML);
        }
    }
    
    handleDragOver(e) {
        if (e.preventDefault) {
            e.preventDefault();
        }
        
        e.dataTransfer.dropEffect = 'move';
        
        const target = e.target.closest('.stock-card');
        if (target && target !== this.draggedElement) {
            const rect = target.getBoundingClientRect();
            const midpoint = rect.x + rect.width / 2;
            
            if (e.clientX < midpoint) {
                target.style.borderLeft = '3px solid #1454FE';
                target.style.borderRight = '';
            } else {
                target.style.borderRight = '3px solid #1454FE';
                target.style.borderLeft = '';
            }
        }
        
        return false;
    }
    
    handleDrop(e) {
        if (e.stopPropagation) {
            e.stopPropagation();
        }
        
        const target = e.target.closest('.stock-card');
        if (target && this.draggedElement !== target) {
            const rect = target.getBoundingClientRect();
            const midpoint = rect.x + rect.width / 2;
            
            if (e.clientX < midpoint) {
                target.parentNode.insertBefore(this.draggedElement, target);
            } else {
                target.parentNode.insertBefore(this.draggedElement, target.nextSibling);
            }
            
            // 순서 저장
            this.saveOrder();
        }
        
        return false;
    }
    
    handleDragEnd(e) {
        // 스타일 초기화
        const cards = document.querySelectorAll('.stock-card');
        cards.forEach(card => {
            card.style.opacity = '';
            card.style.borderLeft = '';
            card.style.borderRight = '';
        });
    }
    
    saveOrder() {
        const cards = document.querySelectorAll('.stock-card');
        const order = Array.from(cards)
            .map(card => card.dataset.code)
            .filter(code => code);
        
        // 서버에 순서 저장
        fetch('/api/watchlist/order', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ order })
        });
    }
}
```

### 9.2 키보드 단축키

```javascript
class KeyboardShortcuts {
    constructor() {
        this.shortcuts = {
            'ctrl+k': () => this.openSearch(),
            'ctrl+r': () => this.refreshData(),
            'ctrl+n': () => this.addNewStock(),
            'esc': () => this.closeModals()
        };
        
        this.init();
    }
    
    init() {
        document.addEventListener('keydown', (e) => {
            const key = this.getKeyCombo(e);
            
            if (this.shortcuts[key]) {
                e.preventDefault();
                this.shortcuts[key]();
            }
        });
    }
    
    getKeyCombo(e) {
        const keys = [];
        
        if (e.ctrlKey) keys.push('ctrl');
        if (e.altKey) keys.push('alt');
        if (e.shiftKey) keys.push('shift');
        
        const keyName = e.key.toLowerCase();
        if (keyName !== 'control' && keyName !== 'alt' && keyName !== 'shift') {
            keys.push(keyName);
        }
        
        return keys.join('+');
    }
    
    openSearch() {
        const modal = new StockSearchModal();
        modal.show();
        
        // 포커스 설정
        setTimeout(() => {
            document.getElementById('stockSearchInput').focus();
        }, 300);
    }
    
    refreshData() {
        window.myInvestmentManager.loadWatchlist();
        window.myInvestmentManager.loadPortfolioHistory();
    }
    
    addNewStock() {
        window.myInvestmentManager.openStockModal();
    }
    
    closeModals() {
        // 모든 열린 모달 닫기
        const modals = document.querySelectorAll('.modal.show');
        modals.forEach(modal => {
            const bsModal = bootstrap.Modal.getInstance(modal);
            if (bsModal) {
                bsModal.hide();
            }
        });
    }
}
```

### 9.3 애니메이션 효과

```css
/* 가격 업데이트 애니메이션 */
@keyframes priceUpdate {
    0% {
        background-color: rgba(20, 84, 254, 0.2);
        transform: scale(1.05);
    }
    100% {
        background-color: transparent;
        transform: scale(1);
    }
}

.price-update {
    animation: priceUpdate 0.5s ease-out;
}

/* 카드 추가 애니메이션 */
@keyframes cardAppear {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.stock-card {
    animation: cardAppear 0.3s ease-out;
}

/* 드래그 효과 */
.stock-card.dragging {
    opacity: 0.5;
    transform: rotate(2deg);
    cursor: grabbing;
}

/* 호버 효과 */
.stock-card {
    transition: all 0.2s ease;
}

.stock-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
}

/* 삭제 애니메이션 */
@keyframes cardRemove {
    to {
        opacity: 0;
        transform: scale(0.8);
    }
}

.stock-card.removing {
    animation: cardRemove 0.3s ease-out forwards;
}
```

---

## 10. 보안 및 데이터 관리

### 10.1 데이터 암호화

```python
from cryptography.fernet import Fernet
import os

class DataEncryption:
    """민감한 투자 데이터 암호화"""
    
    def __init__(self):
        # 환경 변수에서 키 로드
        key = os.environ.get('ENCRYPTION_KEY')
        if not key:
            raise ValueError("암호화 키가 설정되지 않았습니다")
        
        self.cipher = Fernet(key.encode())
    
    def encrypt_portfolio(self, portfolio_data):
        """포트폴리오 데이터 암호화"""
        json_str = json.dumps(portfolio_data)
        encrypted = self.cipher.encrypt(json_str.encode())
        return encrypted.decode()
    
    def decrypt_portfolio(self, encrypted_data):
        """포트폴리오 데이터 복호화"""
        try:
            decrypted = self.cipher.decrypt(encrypted_data.encode())
            return json.loads(decrypted.decode())
        except Exception as e:
            logger.error(f"복호화 실패: {e}")
            return None
```

### 10.2 접근 권한 관리

```python
from functools import wraps

def require_auth(f):
    """인증 필요 데코레이터"""
    @wraps(f)
    def decorated_function(*args, **kwargs):
        # 세션 확인
        if 'user_id' not in session:
            return jsonify({'error': 'Authentication required'}), 401
        
        # 사용자 검증
        user_id = session['user_id']
        
        # Supabase에서 사용자 확인
        supabase = get_supabase_client()
        if supabase:
            result = supabase.table('users').select('id').eq('id', user_id).execute()
            if not result.data:
                return jsonify({'error': 'Invalid user'}), 403
        
        return f(*args, **kwargs)
    
    return decorated_function

# 적용 예시
@app.route('/api/portfolio', methods=['POST'])
@require_auth
def update_portfolio():
    """포트폴리오 업데이트 (인증 필요)"""
    # ...
```

### 10.3 데이터 백업

```python
class DataBackupManager:
    """정기적인 데이터 백업"""
    
    def __init__(self):
        self.backup_dir = 'backups'
        os.makedirs(self.backup_dir, exist_ok=True)
    
    def backup_user_data(self, user_id):
        """사용자 데이터 백업"""
        timestamp = datetime.now().strftime('%Y%m%d_%H%M%S')
        
        # 데이터 수집
        data = {
            'user_id': user_id,
            'timestamp': timestamp,
            'watchlist': self.get_watchlist(user_id),
            'portfolio': self.get_portfolio(user_id),
            'transactions': self.get_transactions(user_id),
            'settings': self.get_settings(user_id)
        }
        
        # 파일로 저장
        filename = f"{self.backup_dir}/backup_{user_id}_{timestamp}.json"
        with open(filename, 'w', encoding='utf-8') as f:
            json.dump(data, f, ensure_ascii=False, indent=2)
        
        # 암호화
        if self.encryption_enabled:
            self.encrypt_backup(filename)
        
        return filename
    
    def restore_user_data(self, user_id, backup_file):
        """백업에서 데이터 복원"""
        try:
            # 복호화
            if self.encryption_enabled:
                backup_file = self.decrypt_backup(backup_file)
            
            # 데이터 로드
            with open(backup_file, 'r', encoding='utf-8') as f:
                data = json.load(f)
            
            # 데이터 복원
            self.restore_watchlist(user_id, data['watchlist'])
            self.restore_portfolio(user_id, data['portfolio'])
            self.restore_transactions(user_id, data['transactions'])
            self.restore_settings(user_id, data['settings'])
            
            return True
            
        except Exception as e:
            logger.error(f"데이터 복원 실패: {e}")
            return False
```

---

## 마무리

MY 투자 페이지는 사용자의 투자 활동을 종합적으로 관리하는 개인화된 대시보드입니다. 주요 특징:

1. **관심종목 관리**: 실시간 주가 추적 및 뉴스 모니터링
2. **포트폴리오 분석**: 성과 측정 및 리스크 관리
3. **데이터 시각화**: 차트와 히트맵을 통한 직관적인 정보 제공
4. **실시간 업데이트**: WebSocket/폴링을 통한 실시간 데이터
5. **보안 강화**: 데이터 암호화 및 접근 권한 관리

이 문서는 MY 투자 페이지의 전체 구현을 상세히 다루며, 개인화된 투자 관리 플랫폼 구축을 위한 기술적 참고 자료로 활용될 수 있습니다.