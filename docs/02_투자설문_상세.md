# 📋 Pixie 투자 설문 페이지 개발 문서

## 🎯 페이지 개요

### 목적
사용자의 투자 성향과 위험 선호도를 분석하여 개인화된 투자 추천을 제공하기 위한 설문조사 시스템입니다.

### 주요 기능
- 투자 성향 분석 설문
- 위험 선호도 측정
- 투자 목표 설정
- 실시간 결과 분석
- 개인화된 투자 프로필 생성

## 🏗️ 기술적 아키텍처

### 프론트엔드 구조
```
web/templates/
├── survey.html              # 메인 설문 페이지
├── survey_result.html       # 설문 결과 페이지
└── survey-questions.html    # 설문 질문 템플릿
```

### 백엔드 구조
```
web/
├── app.py                   # 설문 처리 라우트
├── blueprints/
│   └── survey/             # 설문 관련 라우트
└── services/
    ├── survey_service.py    # 설문 분석 서비스
    └── profile_service.py   # 프로필 생성 서비스
```

## 📱 UI/UX 설계

### 설문 진행 방식
1. **단계별 진행**
   - 총 6개 섹션으로 구성
   - 각 섹션별 진행률 표시
   - 이전/다음 버튼으로 네비게이션

2. **질문 유형**
   - 객관식 (5점 척도)
   - 시나리오 기반 질문
   - 투자 경험 관련 질문

3. **실시간 피드백**
   - 답변에 따른 즉시 분석
   - 진행 상황 시각화
   - 임시 저장 기능

## 🔧 핵심 기능 구현

### 1. 설문 질문 시스템
```python
# web/services/survey_service.py
class SurveyService:
    def __init__(self):
        self.questions = self.load_survey_questions()
        self.scoring_rules = self.load_scoring_rules()
    
    def load_survey_questions(self) -> List[Dict[str, Any]]:
        """설문 질문 로드"""
        return [
            {
                'id': 1,
                'section': 'risk_tolerance',
                'question': '투자 손실에 대한 귀하의 반응은?',
                'options': [
                    {'value': 1, 'text': '매우 민감함 - 잠을 못 이룸'},
                    {'value': 2, 'text': '민감함 - 걱정이 됨'},
                    {'value': 3, 'text': '보통 - 적당히 신경 씀'},
                    {'value': 4, 'text': '덜 민감함 - 크게 신경 안 씀'},
                    {'value': 5, 'text': '전혀 민감하지 않음 - 당연한 일로 봄'}
                ]
            }
        ]
```

### 2. 답변 처리 및 분석
```python
# web/services/survey_analysis_service.py
class SurveyAnalysisService:
    def analyze_survey_responses(self, responses: List[Dict[str, Any]]) -> Dict[str, Any]:
        """설문 답변 분석"""
        try:
            # 각 섹션별 점수 계산
            risk_tolerance = self.calculate_risk_tolerance(responses)
            investment_horizon = self.calculate_investment_horizon(responses)
            financial_goals = self.calculate_financial_goals(responses)
            investment_experience = self.calculate_investment_experience(responses)
            
            # 종합 투자 성향 분석
            overall_profile = self.generate_overall_profile({
                'risk_tolerance': risk_tolerance,
                'investment_horizon': investment_horizon,
                'financial_goals': financial_goals,
                'investment_experience': investment_experience
            })
            
            return {
                'scores': {
                    'risk_tolerance': risk_tolerance,
                    'investment_horizon': investment_horizon,
                    'financial_goals': financial_goals,
                    'investment_experience': investment_experience
                },
                'overall_profile': overall_profile,
                'recommendations': self.generate_recommendations(overall_profile),
                'risk_level': self.determine_risk_level(overall_profile)
            }
            
        except Exception as e:
            logger.error(f"설문 분석 실패: {e}")
            return {}
```

## 📊 데이터베이스 구조

### 설문 응답 테이블
```sql
CREATE TABLE survey_responses (
    id SERIAL PRIMARY KEY,
    user_id VARCHAR(50) NOT NULL,
    question_id INTEGER NOT NULL,
    section VARCHAR(50) NOT NULL,
    answer INTEGER NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE user_profiles (
    id SERIAL PRIMARY KEY,
    user_id VARCHAR(50) UNIQUE NOT NULL,
    risk_tolerance DECIMAL(5,2),
    investment_horizon DECIMAL(5,2),
    financial_goals DECIMAL(5,2),
    investment_experience DECIMAL(5,2),
    overall_profile VARCHAR(50),
    risk_level VARCHAR(20),
    recommendations JSONB,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

## 🎨 결과 시각화

### 투자 성향 차트
```javascript
// web/static/js/survey-charts.js
class SurveyChartManager {
    constructor() {
        this.charts = {};
        this.init();
    }
    
    createRadarChart() {
        const ctx = document.getElementById('radar-chart').getContext('2d');
        this.charts.radar = new Chart(ctx, {
            type: 'radar',
            data: {
                labels: ['위험 선호도', '투자 기간', '재무 목표', '투자 경험'],
                datasets: [{
                    label: '투자 성향',
                    data: [75, 60, 80, 45],
                    backgroundColor: 'rgba(102, 126, 234, 0.2)',
                    borderColor: 'rgba(102, 126, 234, 1)',
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    r: {
                        beginAtZero: true,
                        max: 100,
                        ticks: {
                            stepSize: 20
                        }
                    }
                }
            }
        });
    }
}
```

## 🔐 데이터 보안

### 개인정보 보호
```python
# web/services/privacy_service.py
class PrivacyService:
    def anonymize_user_data(self, user_id: str) -> str:
        """사용자 ID 익명화"""
        import hashlib
        salt = os.environ.get('ANONYMIZATION_SALT', 'default_salt')
        return hashlib.sha256(f"{user_id}{salt}".encode()).hexdigest()[:16]
    
    def encrypt_survey_data(self, data: Dict[str, Any]) -> str:
        """설문 데이터 암호화"""
        from cryptography.fernet import Fernet
        key = os.environ.get('SURVEY_ENCRYPTION_KEY')
        f = Fernet(key)
        return f.encrypt(json.dumps(data).encode()).decode()
```

## 📈 성능 최적화

### 캐싱 전략
```python
# web/services/survey_cache_service.py
class SurveyCacheService:
    def __init__(self):
        self.redis_client = redis.Redis(host='localhost', port=6379, db=0)
    
    def cache_survey_progress(self, user_id: str, progress: Dict[str, Any]):
        """설문 진행 상황 캐싱"""
        cache_key = f"survey_progress:{user_id}"
        self.redis_client.setex(cache_key, 3600, json.dumps(progress))  # 1시간
    
    def get_cached_progress(self, user_id: str) -> Optional[Dict[str, Any]]:
        """캐시된 진행 상황 조회"""
        cache_key = f"survey_progress:{user_id}"
        cached_data = self.redis_client.get(cache_key)
        return json.loads(cached_data) if cached_data else None
```

## 🧪 테스트 전략

### 단위 테스트
```python
# tests/test_survey_service.py
import pytest
from web.services.survey_service import SurveyService

class TestSurveyService:
    def test_load_survey_questions(self):
        """설문 질문 로드 테스트"""
        service = SurveyService()
        questions = service.load_survey_questions()
        
        assert len(questions) > 0
        assert all('id' in q for q in questions)
        assert all('question' in q for q in questions)
        assert all('options' in q for q in questions)
```

## 🚀 배포 및 운영

### 환경 설정
```python
# web/config/survey_config.py
class SurveyConfig:
    # 설문 설정
    SURVEY_TIMEOUT = 1800  # 30분
    MAX_QUESTIONS = 30
    MIN_QUESTIONS = 25
    
    # 분석 설정
    CONSISTENCY_THRESHOLD = 70.0
    RELIABILITY_THRESHOLD = 80.0
    
    # 캐시 설정
    PROGRESS_CACHE_TTL = 3600  # 1시간
    RESULT_CACHE_TTL = 86400   # 24시간
```

## 📊 분석 및 개선

### 사용자 행동 분석
```python
# web/services/survey_analytics_service.py
class SurveyAnalyticsService:
    def analyze_completion_patterns(self) -> Dict[str, Any]:
        """설문 완료 패턴 분석"""
        return {
            'average_completion_time': self.get_avg_completion_time(),
            'completion_rate_by_section': self.get_completion_rate_by_section(),
            'abandonment_points': self.get_abandonment_points(),
            'user_satisfaction_score': self.get_satisfaction_score()
        }
```

## 🔄 향후 개선 계획

### 단기 개선사항 (1-2개월)
1. **동적 질문 시스템** 구현
2. **음성 입력** 지원
3. **다국어** 지원
4. **모바일 최적화** 개선

### 중기 개선사항 (3-6개월)
1. **AI 기반 질문 생성** 시스템
2. **실시간 피드백** 강화
3. **소셜 로그인** 통합
4. **진행 상황 저장** 기능

### 장기 개선사항 (6개월 이상)
1. **VR/AR 설문** 환경
2. **생체 인식** 기반 분석
3. **감정 분석** 통합
4. **개인화된 질문** 시퀀스

## 📚 참고 자료

### 기술 스택
- **프론트엔드**: HTML5, CSS3, JavaScript (ES6+)
- **차트 라이브러리**: Chart.js
- **백엔드**: Python Flask
- **데이터베이스**: PostgreSQL, Redis
- **분석**: NumPy, Pandas

### 라이브러리 및 도구
- **UI 프레임워크**: Bootstrap 5
- **폼 검증**: jQuery Validation
- **애니메이션**: CSS3 Transitions
- **테스트**: pytest, Selenium
- **모니터링**: Prometheus, Grafana

이 문서는 Pixie 투자챗봇의 설문 시스템 개발 과정과 기술적 세부사항을 상세히 다루고 있습니다. 사용자 경험을 지속적으로 개선하여 더 정확한 투자 성향 분석을 제공하는 것이 목표입니다. 